# 東京ラーメンヒートマップ 設計書

## 1. プロジェクト概要

東京エリアのラーメン店舗分布をヒートマップで可視化する Web アプリケーション。
deck.gl と Next.js を使用し、OpenStreetMap からデータを取得して地理空間データの密度を表示する。

## 2. 技術スタック

- **フロントエンド**：
  - Next.js (React フレームワーク)
  - TypeScript
  - deck.gl (WebGL ベースの地理空間可視化ライブラリ)
  - react-map-gl (Mapbox の React ラッパー)
- **バックエンド**：
  - Next.js API Routes（サーバーサイド処理）
- **データソース**：
  - OpenStreetMap（Overpass API）

## 3. アプリケーション構造

```
ramen-heatmap/
├── app/
│   ├── api/
│   │   └── ramen/
│   │       └── route.ts     # ラーメン店データ取得用API
│   ├── page.tsx             # メインページ
│   └── layout.tsx           # レイアウトコンポーネント
├── components/
│   └── RamenHeatmap.tsx     # ヒートマップコンポーネント
├── lib/
│   └── overpass.ts          # Overpass APIクライアント
├── types/
│   └── index.ts             # 型定義
├── public/
│   └── ... (静的ファイル)
└── ... (設定ファイル)
```

## 4. 主要コンポーネント詳細

### 4.1 API Route (`app/api/ramen/route.ts`)

- **機能**：

  - Overpass API を使用して東京エリアのラーメン店データを取得
  - CORS 問題を解決
  - レスポンスキャッシュ（s-maxage=3600）

- **エンドポイント**：
  - `GET /api/ramen` - ラーメン店データを返す

### 4.2 ヒートマップコンポーネント (`components/RamenHeatmap.tsx`)

- **機能**：
  - deck.gl の`HeatmapLayer`を使用してラーメン店の密度を可視化
  - react-map-gl の`StaticMap`でベースマップを描画
  - ズーム/パン操作のインタラクション

### 4.3 メインページ (`app/page.tsx`)

- **機能**：
  - RamenHeatmap コンポーネントのラッパー
  - タイトルと簡単な説明

## 5. データフロー

1. ユーザーがアプリにアクセス
2. クライアントが API Route `/api/ramen` にリクエスト
3. API Route が以下を実行：
   - キャッシュ確認
   - キャッシュがない場合、Overpass API にリクエスト
   - ラーメン店データを取得・整形
   - キャッシュヘッダーを設定してレスポンス
4. クライアントがデータを受け取りヒートマップを描画

## 6. キャッシュ戦略

- API Route レスポンスにキャッシュヘッダー設定：
  ```
  Cache-Control: s-maxage=3600, stale-while-revalidate
  ```
- 1 時間のキャッシュでサーバー負荷を軽減
- バックグラウンドでのデータ再検証

## 7. デプロイフロー

1. GitHub リポジトリにコード管理
2. Vercel と連携した自動デプロイ
3. Qiita/Zenn での解説記事と実装のポイント紹介
4. SNS での技術共有

## 8. 拡張可能性

- 時間帯別の人気度表示
- 店舗種類（二郎系、家系など）によるフィルタリング
- エリア別（渋谷、新宿、池袋など）の比較表示
- ユーザーレビューデータの統合
- モバイル対応強化

## 9. 実装上の考慮点

- **データ取得方法**：
  - 東京全域のデータ量が多いため、エリアを分割して取得
  - または東京 23 区ごとにデータを取得してマージ
- **パフォーマンス最適化**：

  - データ量が大きい場合のクラスタリング処理
  - 視野範囲に応じた動的データ読み込み

- **エラー処理**：
  - Overpass API のクエリタイムアウト対策
  - データ取得失敗時のフォールバック表示
